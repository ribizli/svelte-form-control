"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("svelte/store");const e=(t,e)=>{if(!Array.isArray(t))return null;for(const r of t)if("function"==typeof r)try{const t=r(e);if(null!=t)return t}catch(t){console.error("validator error",r,t)}return null};class r{constructor(e){this.validators=t.writable(e)}setValidators(t){Array.isArray(t)&&t.length&&this.validators.set(t)}}class s extends r{constructor(r,s=[]){super(s),this.initial=r,this.value=t.writable(this.initial),this.touched=t.writable(!1),this.state=t.derived([this.value,this.touched,this.validators],(([t,r,s])=>{const o=e(s,t);return{$error:o,$valid:null==o,$touched:r,$dirty:this.initial!==t}}))}setTouched(t){this.touched.set(t)}child(){return null}reset(t){void 0!==t&&(this.initial=t),this.value.set(this.initial),this.touched.set(!1)}}const o=/^([^.[]+)\.?(.*)$/;const i=/^\[(\d+)\]\.?(.*)$/;const l=t=>null==t||""==`${t}`,n=/^([a-zA-Z0-9_\-\.]+)@([a-zA-Z0-9_\-\.]+)\.([a-zA-Z]{2,5})$/,a=/^\d*\.?\d+$/,u=/^\d+$/;exports.Control=s,exports.ControlArray=class extends r{constructor(r,s=[]){super(s),this._controls=r,this.controlStore=t.writable(this._controls),this.controls={subscribe:this.controlStore.subscribe},this.valueDerived=t.derived(this.controlStore,((e,r)=>t.derived(e.map((t=>t.value)),(t=>t)).subscribe(r))),this.childStateDerived=t.derived(this.controlStore,((e,r)=>t.derived(e.map((t=>t.state)),(t=>t)).subscribe(r))),this.value={subscribe:this.valueDerived.subscribe,set:t=>this.setValue(t),update:e=>this.setValue(e(t.get(this.valueDerived)))},this.state=t.derived([this.valueDerived,this.childStateDerived,this.validators],(([t,r,s])=>{const o={list:[]};let i=!0;for(let t=0,e=r.length;t<e;t++){const e=r[t];o.list[t]=e,i=i&&e.$valid,o.$touched=o.$touched||e.$touched,o.$dirty=o.$dirty||e.$dirty}return o.$error=e(s,t),o.$valid=null==o.$error&&i,o}))}iterateControls(e){t.get(this.controlStore).forEach(e)}setValue(t){this.iterateControls(((e,r)=>{var s;const o=null!==(s=null==t?void 0:t[r])&&void 0!==s?s:null;e.value.set(o)}))}setTouched(t){this.iterateControls((e=>e.setTouched(t)))}pushControl(t){this.controlStore.update((e=>(e.push(t),e)))}addControlAt(t,e){this.controlStore.update((r=>(r.splice(t,0,e),r)))}removeControlAt(t){this.controlStore.update((e=>(e.splice(t,1),e)))}removeControl(t){this.controlStore.update((e=>e.filter((e=>e!==t))))}slice(t,e){this.controlStore.update((r=>r.slice(t,e)))}child(e){const[r,s,o]=e.match(i)||[],l=t.get(this.controlStore),n=null!=s&&l[+s]||null;return n?o?n.child(o):n:null}reset(t){this.iterateControls(((e,r)=>{const s=t&&t[r]||null;e.reset(s)}))}},exports.ControlBase=r,exports.ControlGroup=class extends r{constructor(r,s=[]){super(s),this.controlStore=t.writable({}),this.controls={subscribe:this.controlStore.subscribe},this.valueDerived=t.derived(this.controlStore,((e,r)=>{const s=Object.keys(e),o=s.map((t=>e[t].value));return t.derived(o,(t=>t.reduce(((t,e,r)=>(t[s[r]]=e,t)),{}))).subscribe(r)})),this.childStateDerived=t.derived(this.controlStore,((e,r)=>{const s=Object.keys(e),o=s.map((t=>e[t].state));return t.derived(o,(t=>t.reduce(((t,e,r)=>(t[s[r]]=e,t)),{}))).subscribe(r)})),this.value={subscribe:this.valueDerived.subscribe,set:t=>this.setValue(t),update:e=>this.setValue(e(t.get(this.valueDerived)))},this.state=t.derived([this.valueDerived,this.childStateDerived,this.validators],(([t,r,s])=>{const o={};let i=!0,l=!1,n=!1;for(const t of Object.keys(r)){const e=o[t]=r[t];i=i&&e.$valid,l=l||e.$touched,n=n||e.$dirty}const a=e(s,t),u=null==a&&i;return Object.assign({$error:a,$valid:u,$touched:l,$dirty:n},o)})),this.controlStore.set(r)}iterateControls(e){const r=t.get(this.controlStore);Object.entries(r).forEach(e)}setValue(t){this.iterateControls((([e,r])=>{var s;const o=null!==(s=null==t?void 0:t[e])&&void 0!==s?s:null;r.value.set(o)}))}addControl(t,e){this.controlStore.update((r=>(r[t]=e,r)))}removeControl(t){this.controlStore.update((e=>(delete e[t],e)))}setTouched(t){this.iterateControls((([e,r])=>{r.setTouched(t)}))}child(e){const[r,s,i]=e.match(o)||[],l=t.get(this.controlStore),n=s&&l[s]||null;return n?i?n.child(i):n:null}reset(t){this.iterateControls((([e,r])=>{const s=t&&t[e]||null;r.reset(s)}))}},exports.controlClasses=(e,r)=>{if(!(r instanceof s))throw new Error("must be used with a Control class");const o=e.classList,i=r.state.subscribe((t=>{t.$error?(o.add("invalid"),o.remove("valid")):(o.add("valid"),o.remove("invalid")),t.$dirty?(o.add("dirty"),o.remove("pristine")):(o.add("pristine"),o.remove("dirty")),t.$touched?o.add("touched"):o.remove("touched")})),l=["blur","focusout"],n=()=>{t.get(r.state).$touched||r.setTouched(!0)};return l.forEach((t=>e.addEventListener(t,n))),{destroy(){l.forEach((t=>e.removeEventListener(t,n))),i()}}},exports.decimal=t=>l(t)||!isNaN(+t)&&a.test(`${t}`)?null:{decimal:!0},exports.email=t=>l(t)||n.test(t)?null:{email:!0},exports.integer=t=>l(t)||!isNaN(+t)&&u.test(`${t}`)?null:{integer:!0},exports.max=t=>e=>l(e)||!isNaN(+e)&&(null==t||e<=t)?null:{max:t},exports.maxLength=t=>e=>l(e)||null==t||`${e}`.trim().length<=t?null:{maxLength:t},exports.min=t=>e=>l(e)||!isNaN(+e)&&(null==t||e>=t)?null:{min:t},exports.minLength=t=>e=>l(e)||null==t||`${e}`.trim().length>=t?null:{minLength:t},exports.number=t=>l(t)||!isNaN(+t)?null:{number:!0},exports.pattern=t=>e=>l(e)||null==t||t.test(e)?null:{pattern:`${t}`},exports.required=t=>""!==(null!=t&&!1!==t?`${t}`.trim():"")?null:{required:!0};
//# sourceMappingURL=index.js.map
